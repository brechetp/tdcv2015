img1 = single(imread('box.pgm'));
img2 = single(imread('scene.pgm'));
P1 = [1, 1, 1; 2, 2, 1; 3, 2, 1; 5, 5, 1];
P2 = [2, 2, 1; 3, 3, 1; 4, 3, 1; 6, 6, 1];
%H = dlt(P1, P2)
[f1,d1] = vl_sift(img1);
[f2,d2] = vl_sift(img2);
[matches, scores] = vl_ubcmatch(d1, d2);
second = f2(1:2, matches(2, :))';
first = f1(1:2, matches(1, :))';

P11 = [first, ones(size(first,1), 1)];
P22 = [second, ones(size(second,1), 1)];

[bestIn, H] = ransac(P11, P22, 4, 5, size(matches, 2) * 0.7, 100);
T = projective2d(H)
theta = 10;
tform = projective2d([cosd(theta) -sind(theta) 0.001; sind(theta) cosd(theta) 0.01; 0 0 1]);
T = affine2d([1 0 -0; .5 1 0; 0 0 1])
imgTrans = imwarp(img1, T);
figure(1);
imshow(uint8(imgTrans))
figure(2);
imshow(uint8(img2));


